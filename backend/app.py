from flask import Flask, jsonify, request
from flask_cors import CORS
from process_dataset import get_test_dataset, load_forms
from configuration import PATH_TO_SENTENCES_IMAGES, PATH_TO_TEMP
from model import predict, predict_form, predict_own_handwriting
import random
import io
from PIL import Image
import base64
import cv2
import numpy as np

app = Flask(__name__)
CORS(app)


def read_and_crop_image(image):
    image = image.split(',')[-1]
    image_bytes = base64.b64decode(image)
    image = Image.open(io.BytesIO(image_bytes))
    image_np = np.array(image)
    image_np = cv2.cvtColor(image_np, cv2.COLOR_RGB2BGR)
    gray = cv2.cvtColor(image_np, cv2.COLOR_BGR2GRAY)
    _, thresholded = cv2.threshold(gray, 0, 255, cv2.THRESH_BINARY_INV + cv2.THRESH_OTSU)
    contours, _ = cv2.findContours(thresholded, cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_SIMPLE)
    min_x = min_y = float('inf')
    max_x = max_y = 0
    for contour in contours:
        x, y, w, h = cv2.boundingRect(contour)
        min_x = min(min_x, x)
        min_y = min(min_y, y)
        max_x = max(max_x, x + w)
        max_y = max(max_y, y + h)
    cropped_image = image_np[min_y:max_y, min_x:max_x]
    cropped_image = cv2.cvtColor(cropped_image, cv2.COLOR_BGR2RGB)
    cropped_pil_image = Image.fromarray(cropped_image)
    return cropped_pil_image


@app.route('/predict', methods=['GET'])
def predict_text():
    dataset = get_test_dataset()
    image, predicted_label, label = predict(dataset)
    with open(image, 'rb') as image_file:
        image_data = image_file.read()
        image_base64 = base64.b64encode(image_data).decode('utf-8')
    response = jsonify({'image': image_base64, 'predicted_label': predicted_label, 'label': label})
    response.headers.add('Access-Control-Allow-Origin', 'http://localhost:4200')
    return response


@app.route('/random_form', methods=['GET'])
def random_form():
    forms = load_forms()
    random_form = random.choice(list(forms.keys()))
    images = []
    for image in forms[random_form]:
        with open(PATH_TO_SENTENCES_IMAGES + image, "rb") as image_file:
            images.append(base64.b64encode(image_file.read()).decode("utf-8"))
    text = predict_form(random_form)
    response = jsonify({'images': images, 'text': text})
    response.headers.add('Access-Control-Allow-Origin', 'http://localhost:4200')
    return response


@app.route('/read_handwriting', methods=['POST'])
def read_handwriting():
    image = request.json['image']
    # image = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABdwAAAH0CAYAAAAnhe8sAAAAAXNSR0IArs4c6QAAIABJREFUeF7t3U2oXVfZB/DV9+arSUjS2IIVhKqIOEgH4kRMFbRTi4IfZCwE/Bgo9w4rDqqzm6QFo2Bx4CyWgEKnVtBGEMRJOlCoxQ4UqlaTGPN5P/KyU269uffss/c559mf69fh232etdbvWcdX/2fdtR+6d+/eveQfAgQIECBAgAABAgQIECBAgAABAgQIECBAYCGBhwTuC/n5MAECBAgQIECAAAECBAgQIECAAAECBAgQuC8gcLcRCBAgQIAAAQIECBAgQIAAAQIECBAgQIBAgIDAPQBRCQIECBAgQIAAAQIECBAgQIAAAQIECBAgIHC3BwgQIECAAAECBAgQIECAAAECBAgQIECAQICAwD0AUQkCBAgQIECAAAECBAgQIECAAAECBAgQICBwtwcIECBAgAABAgQIECBAgAABAgQIECBAgECAgMA9AFEJAgQIECBAgAABAgQIECBAgAABAgQIECAgcLcHCBAgQIAAAQIECBAgQIAAAQIECBAgQIBAgIDAPQBRCQIECBAgQIAAAQIECBAgQIAAAQIECBAgIHC3BwgQIECAAAECBAgQIECAAAECBAgQIECAQICAwD0AUQkCBAgQIECAAAECBAgQIECAAAECBAgQICBwtwcIECBAgAABAgQIECBAgAABAgQIECBAgECAgMA9AFEJAgQIECBAgAABAgQIECBAgAABAgQIECAgcLcHCBAgQIAAAQIECBAgQIAAAQIECBAgQIBAgIDAPQBRCQIECBAgQIAAAQIECBAgQIAAAQIECBAgIHC3BwgQIECAAAECBAgQIECAAAECBAgQIECAQICAwD0AUQkCBAgQIECAAAECBAgQIECAAAECBAgQICBwtwcIECBAgAABAgQIECBAgAABAgQIECBAgECAgMA9AFEJAgQIECBAgAABAgQIECBAgAABAgQIECAgcLcHCBAgQIAAAQIECBAgQIAAAQIECBAgQIBAgIDAPQBRCQIECBAgQIAAAQIECBAgQIAAAQIECBAgIHC3BwgQIECAAAECBAgQIECAAAECBAgQIECAQICAwD0AUQkCBAgQIECAAAECBAgQIECAAAECBAgQICBwtwcIECBAgAABAgQIECBAgAABAgQIECBAgECAgMA9AFEJAgQIECBAgAABAgQIECBAgAABAgQIECAgcLcHCBAgQIAAAQIECBAgQIAAAQIECBAgQIBAgIDAPQBRCQIECBAgQIAAAQIECBAgQIAAAQIECBAgIHC3BwgQIECAAAECBAgQIECAAAECBAgQIECAQICAwD0AUQkCBAgQIECAAAECBAgQIECAAAECBAgQICBwtwcIECBAgAABAgQIECBAgAABAgQIECBAgECAgMA9AFEJAgQIECBAgAABAgQIECBAgAABAgQIECAgcLcHCBAgQIAAAQIECBAgQIAAAQIECBAgQIBAgIDAPQBRCQIECBAgQIAAAQIECBAgQIAAAQIECBAgIHC3BwgQIECAAAECBAgQIECAAAECBAgQIECAQICAwD0AUQkCBAgQIECAAAECBAgQIECAAAECBAgQICBwtwcIECBAgAABAgQIECBAgAABAgQIECBAgECAgMA9AFEJAgQIECBAgAABAgQIECBAgAABAgQIECAgcLcHCBAgQIAAAQIECBAgQIAAAQIECBAgQIBAgIDAPQBRCQIECBAgQIAAAQIECBAgQIAAAQIECBAgIHC3BwgQIECAAAECBAgQIECAAAECBAgQIECAQICAwD0AUQkCBAgQIECAAAECBAgQIECAAAECBAgQICBwtwcIECBAgAABAgQIECBAgAABAgQIECBAgECAgMA9AFEJAgQIECBAgAABAgQIECBAgAABAgQIECAgcLcHCBAgQIAAAQIECBAgQIAAAQIECBAgQIBAgIDAPQBRCQIECBAgQIAAAQIECBAgQIAAAQIECBAgIHC3BwgQIECAAAECBAgQIECAAAECBAgQIECAQICAwD0AUQkCBAgQIECAAAECBAgQIECAAAECBAgQICBwtwcIECBAgAABAgQIECBAgAABAgQIECBAgECAgMA9AFEJAgQIECBAgAABAgQIECBAgAABAgQIECAgcLcHCBAgQIAAAQIECBAgQIAAAQIECBAgQIBAgIDAPQBRCQIECBAgQIAAAQIECBAgQIAAAQIECBAgIHC3BwgQIECAAAECBAgQIECAAAECBAgQIECAQICAwD0AUQkCBAgQIECAAAECBAgQIECAAAECBAgQICBwtwcIECBAgAABAgQIECBAgAABAgQIECBAgECAgMA9AFEJAgQIECBAgAABAgQIECBAgAABAgQIECAgcLcHCBAgQIAAAQIECBAgQIAAAQIECBAgQIBAgIDAPQBRCQIECBAgQIAAAQIECBAgQIAAAQIECBAgIHC3BwgQIECAAAECBAgQIECAAAECBAgQIECAQICAwD0AUQkCBAgQIECAAAECBAgQIECAAAECBAgQICBwtwcIECBAgAABAgQIECBAgAABAgQIECBAgECAgMA9AFEJAgQIECBAgAABAgQIECBAgAABAgQIECAgcLcHCBAgQIAAAQIECBAgQIAAAQIECBAgQIBAgIDAPQBRCQIECBAgQIAAAQIECBAgQIAAAQIECBAgIHC3BwgQIECAAAECBAgQIECAAAECBAgQIECAQICAwD0AUQkCBAgQIECAAAECBAgQIECAAAECBAgQICBwtwcIECBAgAABAgQIECBAgAABAgQIECBAgECAgMA9AFEJAgQIECBAgAABAgQIECBAgAABAgQIECAgcLcHCBAgQIAAAQIECBAgQIAAAQIECBAgQIBAgIDAPQBRCQIECBAgQIAAAQIECBAgQIAAAQIECBAgIHC3BwgQIECAAAECBAgQIECAAAECBAgQIECAQICAwD0AUQkCBAgQIECAAAECBAgQIECAAAECBAgQICBwtwcIECBAgAABAgQIECBAgAABAgQIECBAgECAgMA9AFEJAgQIECBAgAABAgQIECBAgAABAgQIECAgcLcHCBAgQIAAAQIECBAgQIAAAQIECBAgQIBAgIDAPQBRCQIECBAgQIAAAQIECBAgQIAAAQIECBAgIHC3BwgQIECAAAECBAgQIECAAAECBAgQIECAQICAwD0AUQkCBAgQIECAAAECBAgQIECAAAECBAgQICBwtwcIECBAgAABAgQIECBAgAABAgQIECBAgECAgMA9AFEJAgQIECBAgAABAgQIECBAgAABAgQIECAgcLcHCBAgQIAAAQIECBAgQIAAAQIECBAgQIBAgIDAPQBRCQIECBAgQIAAAQIECBAgQIAAAQIECBAgIHC3BwgQIECAAAECBAgQIECAAAECBAgQIECAQICAwD0AUQkCBAgQIECAAAECBAgQIECAAAECBAgQICBwtwcIECBAgAABAgQIECBAgAABAgQIECBAgECAgMA9AFEJAgQIECBAgAABAgQIECBAgAABAgQIECAgcLcHCBAgQIAAAQIECBAgQIAAAQIECBAgQIBAgIDAPQBRCQIECBAgQIAAAQIECBAgQIAAAQIECBAgIHC3BwgQIECAAAECBAgQIECAAAECBAgQIECAQICAwD0AUQkCBAgQIECAAAECBAgQIECAAAECBAgQICBwtwcIECBAgAABAgQIECBAgAABAgQIECBAgECAgMA9AFEJAgQIECBAgAABAgQIECBAgAABAgQIECAgcLcHCBAgQIAAAQIECBAgQIAAAQIECBAgQIBAgIDAPQBRCQIECBAgQIAAAQIECBAgQIAAAQIECBAgIHC3BwgQIECAAAECBAgQIECAAAECBAgQIECAQICAwD0AUQkCBAgQIECAAAECBAgQIECAAAECBAgQICBwtwcIECBAgAABAgQIECBAgAABAgQIECBAgECAgMA9AFEJAgQIECBAgAABAgQIECBAgAABAgQIECAgcLcHCBAgQIAAAQIECBAgQIAAAQIECBAgQIBAgIDAPQBRCQIECBAgQIAAAQIECBAgQIAAAQIECBAgIHC3BwgQIECAAAECBAgQIECAAAECBAgQIECAQICAwD0AUQkCBAgQIECAAAECBAgQIECAAAECBAgQICBwtwcIECBAgAABAgQIECBAgAABAgQIECBAgECAgMA9AFEJAgQIECBAgAABAgQIECBAgAABAgQIECAgcLcHCBAgQIAAAQIECBAgQIAAAQIECBAgQIBAgIDAPQBRCQIECBAgQIAAAQIECBAgQIAAAQIECBAgIHC3BwgQIECAAAECBAgQIECAAAECBAgQIECAQICAwD0AUQkCBAgQIECAAAECBAgQIECAAAECBAgQICBwtwcIECBAgAABAgQIECBAgAABAgQIECBAgECAgMA9AFEJAgQIECBAgAABAgQIECBAgAABAgQIECAgcLcHCBAgQIAAAQIECBAgQIAAAQIECBAgQIBAgIDAPQBRCQIECBAgQIAAAQIECBAgQIAAAQIECBAgIHC3BwgQIECAAAECBAgQIECAAAECBAgQIECAQICAwD0AUQkCBAgQIECAAAECBAgQIECAAAECBAgQICBwtwcIECBAgAABAgQIECBAgAABAgQIECBAgECAgMA9AFEJAgQIECBAgAABAgQIECBAgAABAgQIECAgcLcHCBAgQIAAAQIECBAgQIAAAQIECBAgQIBAgIDAPQBRCQIECBAgQIAAAQIECBAgQIAAAQIECBAgIHC3BwgQIECAAAECBAgQIECAAAECBAgQIECAQICAwD0AUQkCBAgQIECAAAECBAgQIECAAAECBAgQICBwtwcIECBAgAABAgQIECBAgAABAgQIECBAgECAgMA9AFEJAgQIECBAgAABAgQIECBAgAABAgQIECAgcLcHCBAgQIAAAQIECBAgQIAAAQIECBAgQIBAgIDAPQBRCQIECBAgQIAAAQIECBAgQIAAAQIECBAgIHC3BwgQIECAAAECBAgQIECAAAECBAgQIECAQICAwD0AUQkCBAgQIECAAAECBAgQIECAAAECBAgQICBwtwcIECBAgAABAgQIECBAgAABAgQIECBAgECAgMA9AFEJAgQIECBAgAABAgQIECBAgAABAgQIECAgcLcHCBAgQIAAAQIECBAgQIAAAQIECBAgQIBAgIDAPQBRCQIECBAgQIAAAQIECBAgQIAAAQIECBAgIHC3BwgQIECAAAECBAgQIECAAAECBAgQIECAQICAwD0AUQkCBAgQIECAAAECBAgQIECAAAECBAgQICBwtwcIECBAgAABAgQIECBAgAABAgQIECBAgECAgMA9AFEJAgQIECBAgAABAgQIECBAgAABAgQIECAgcLcHCBAgQIAAAQIECBAgQIAAAQIECBAgQIBAgIDAPQBRCQIECBAgQIAAAQIECBAgQIAAAQIECBAgIHC3BwgQIECAAAECBAgQIECAAAECBAgQIECAQICAwD0AUQkCBAgQIECAAAECBAgQIECAAAECBAgQICBwtwcIECBAgAABAgQIECBAgAABAgQIECBAgECAgMA9AFEJAgQIECBAgAABAgQIECBAgAABAgQIECAgcLcHCBAgQIAAAQIECBAgQIAAAQIECBAgQIBAgIDAPQBRCQIECBAgQIAAAQIECBAgQIAAAQIECBAgIHC3BwgQIECAAAECBAgQIECAAAECBAgQIECAQICAwD0AUQkCBAgQIECAAAECBAgQIECAAAECBAgQICBwtwcIECBAgAABAgQIECBAgAABAgQIECBAgECAgMA9AFEJAgQIECBAgAABAgQIECBAgAABAgQIECAgcLcHCBAgQIAAAQIECBAgQIAAAQIECBAgQIBAgIDAPQBRCQIECBAgQIAAAQIECBAgQIAAAQIECBAgIHC3BwgQIECAAAECBAgQIECAAAECBAgQIECAQICAwD0AUQkCBAgQIECAAAECBAgQIECAAAECBAgQICBwtwcIECBAgAABAgQIECBAgAABAgQIECBAgECAgMA9AFEJAgQIECBAgAABAgQIECBAgAABAgQIECAgcLcHCBAgQIAAAQIECBAgQIAAAQIECBAgQIBAgIDAPQBRCQIECBAgQIAAAQIECBAgQIAAAQIECBAgIHC3BwgQIECAAAECBAgQIECAAAECBAgQIECAQICAwD0AUQkCBAgQIECAAAECBAgQIECAAAECBAgQICBwtwcIECBAgAABAgQIECBAgAABAgQIECBAgECAgMA9AFEJAgQIECBAgAABAgQIECBAgAABAgQIECAgcLcHCBAgQIAAAQIECBAgQIAAAQIECBAgQIBAgIDAPQBRCQIECBAgQIAAAQIECBAgQIAAAQIECBAgIHC3BwgQIECAAAECBAgQIECAAAECBAgQIECAQICAwD0AUQkCBAgQIECAAAECBAgQIECAAAECBAgQICBwtwcIECBAgAABAgQIECBAgAABAgQIECBAgECAgMA9AFEJAgQIECBAgAABAgQIECBAgAABAgQIECAgcLcHCBAgQIAAAQIECBAgQIAAAQIECBAgQIBAgIDAPQBRCQIECBAgQIAAAQIECBAgQIAAAQIECBAgIHC3BwgQIECAAAECBAgQIECAAAECBAgQIECAQICAwD0AUQkCBAgQIECAAAECBAgQIECAAAECBAgQICBwtwcIECBAgAABAgQIECBAgAABAgQIECBAgECAgMA9AFEJAgQIECBAgAABAgQIECBAgAABAgQIECAgcLcHCBAgQIAAAQIECBAgQIAAAQIECBAgQIBAgIDAPQBRCQIECBAgQIAAAQIECBAgQIAAAQIECBAgIHC3BwgQIECAAAECBAgQIECAAAECBAgQIECAQICAwD0AUQkCBAgQIECAAAECBAgQIECAAAECBAgQICBwtwcIECBAgAABAgQIECBAgAABAgQIECBAgECAgMA9AFEJAgQIECBAgAABAgQIECBAgAABAgQIECAgcLcHCBAgQIAAAQIECBAgQIAAAQIECBAgQIBAgIDAPQBRCQIECBAgQIAAAQIECBAgQIAAAQIECBAgIHC3BwgQIECAAAECBAgQIECAAAECBAgQIECAQICAwD0AUQkCBAgQIECAAAECBAgQIECAAAECBAgQICBwtwcIECBAgAABAgQIECBAgAABAgQIECBAgECAgMA9AFEJAgQIECBAgAABAgQIECBAgAABAgQIECAgcLcHCBAgQIAAAQIECBAgQIAAAQIECBAgQIBAgIDAPQBRCQIECBAgQIAAAQIECBAgQIAAAQIECBAgIHC3BwgQIECAAAECBAgQIECAAAECBAgQIECAQICAwD0AUQkCBAgQIECAQBsCKysr6ezZs/eH2rt3b7pz504bwxqDAAECBAgQIECAAAECBGoKCNxrQnmMAAECBAgQINClwP79+9Pdu3cfmMK+ffuE7l02xdgECBAgQIAAAQIECBDYISBwtyUIECBAgAABAgMQ+L//+7907969B2b60EMPpc3NzQHM3hQJECBAgAABAgQIECCQh4DAPY8+WyUBAgQIECAwcIEiXN/5j8B94E01fQIECBAgQIAAAQIERicgcB9dSy2IAAECBAgQGJvApNPtxRoF7mPrtPUQIECAAAECBAgQIDB0AYH70Dto/gQIECBAgMCoBcrCdoH7qNtucQQIECBAgAABAgQIDFRA4D7Qxpk2AQIECBAgMH6BPXv2pI2NjdKFOuE+/j1ghQQIECBAgAABAgQIDEtA4D6sfpktAQIECBAgkInAtJPtWwQC90w2g2USIECAAAECBAgQIDAYAYH7YFplogQIECBAgEAuAnXC9sJieXk5ra6u5sJinQQIECBAgAABAgQIEOi9gMC99y0yQQIECBAgQCAngbphe2Fy7969nGislQABAgQIECBAgAABAr0XELj3vkUmSIAAAQIECOQiUFwRU/cf18nUlfIcAQIECBAgQIAAAQIE2hMQuLdnbSQCBAgQIECAQKnALGF7UcTpdpuJAAECBAgQIECAAAEC/RMQuPevJ2ZEgAABAgQIZCSwsrKSzpw5M9OKnW6ficvDBAgQIECAAAECBAgQaE1A4N4atYEIECBAgAABAg8K7NmzJ21sbMzM4mWpM5P5AAECBAgQIECAAAECBFoRELi3wmwQAgQIECBAgMCDAlUvRy1OsZddG+M6GbuJAAECBAgQIECAAAEC/RQQuPezL2ZFgAABAgQIjFigTti+f//+dPv27V0KrpMZ8cawNAIECBAgQIAAAQIEBi8gcB98Cy2AAAECBAgQGIpAnStktgL1speoOt0+lG6bJwECBAgQIECAAAECOQoI3HPsujUTIECAAAEC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IFBTQOBeE8pjBAgQIECAwDAE6t7f7lT7MPpplgQIECBAgAABAgQIEBiSgMB9SN0yVwIECBAgQKBSoCpwd6q9ktADBAgQIECAAAECBAgQIDCngMB9TjgfI0CAAAECBPopMC1wd6q9nz0zKwIECBAgQIAAAQIECIxFQOA+lk5aBwECBAgQIHBfYGVlJZ05c+YBDafabQ4CBAgQIECAAAECBAgQaENA4N6GsjEIECBAgACBVgWK0P3s2bP3x9zc3Gx1bIMRIECAAAECBAgQIECAQL4CAvd8e2/lBAgQIECAAAECBAgQIECAAAECBAgQIBAoIHAPxFSKAAECBAgQIECAAAECBAgQIECAAAECBPIVELjn23srJ0CAAAECBAgQIECAAAECBAgQIECAAIFAAYF7IKZSBAgQIECAAAECBAgQIECAAAECBAgQIJCvgMA9395bOQECBAgQIECAAAECBAgQIECAAAECBAgECgjcAzGVIkCAAAECBAgQIECAAAECBAgQIECAAIF8BQTu+fbeygkQIECAAAECBAgQIECAAAECBAgQIEAgUEDgHoipFAECBAgQIECAAAECBAgQIECAAAECBAjkKyBwz7f3Vk6AAAECBAgQIECAAAECBAgQIECAAAECgQIC90BMpQgQIECAAAECBAgQIECAAAECBAgQIEAgXwGBe769t3ICBAgQIECAAAECBAgQIECAAAECBAgQCBQQuAdiKkWAAAECBAgQIECAAAECBAgQIECAAAEC+QoI3PPtvZUTIECAAAECBAgQIECAAAECBAgQIECAQKCAwD0QUykCBAgQIECAAAECBAgQIECAAAECBAgQyFdA4J5v762cAAECBAgQIECAAAECBAgQIECAAAECBAIFBO6BmEoRIECAAAECBAgQIECAAAECBAgQIECAQL4CAvd8e2/lBAgQIECAAAECBAgQIECAAAECBAgQIBAoIHAPxFSKAAECBAgQIECAAAECBAgQIECAAAECBPIVELjn23srJ0CAAAECBAgQIECAAAECBAgQIECAAIFAAYF7IKZSBAgQIECAAAECBAgQIECAAAECBAgQIJCvgMA9395bOQECBAgQIECAAAECBAgQIECAAAECBAgECgjcAzGVIkCAAAECBAgQIECAAAECBAgQIECAAIF8BQTu+fbeygkQIECAAAECBAgQIECAAAECBAgQIEAgUEDgHoipFAECBAgQIECAAAECBAgQIECAAAECBAjkKyBwz7f3Vk6AAAECBAgQIECAAAECBAgQIECAAAECgQIC90BMpQgQIECAAAECBAgQIECAAAECBAgQIEAgXwGBe769t3ICBAgQIECAAAECBAgQIECAAAECBAgQCBQQuAdiKkWAAAECBAgQIECAAAECBAgQIECAAAEC+QoI3PPtvZUTIECAAAECBAgQIECAAAECBAgQIECAQKCAwD0QUykCBAgQIECAAAECBAgQIECAAAECBAgQyFdA4J5v762cAAECBAgQIECAAAECBAgQIECAAAECBAIFBO6BmEoRIECAAAECBAgQIECAAAECBAgQIECAQL4CAvd8e2/lBAgQIECAAAECBAgQIECAAAECBAgQIBAoIHAPxFSKAAECBAgQIECAAAECBAgQIECAAAECBPIVELjn23srJ0CAAAECBAgQIECAAAECBAgQIECAAIFAAYF7IKZSBAgQIECAAAECBAgQIECAAAECBAgQIJCvgMA9395bOQECBAgQIECAAAECBAgQIECAAAECBAgECgjcAzGVIkCAAAECBAgQIECAAAECBAgQIECAAIF8BQTu+fbeygkQIECAAAECBAgQIECAAAECBAgQIEAgUEDgHoipFAECBAgQIECAAAECBAgQIECAAAECBAjkKyBwz7f3Vk6AAAECBAgQIECAAAECBAgQIECAAAECgQIC90BMpQgQIECAAAECBAgQIECAAAECBAgQIEAgXwGBe769t3ICBAgQIECAAAECBAgQIECAAAECBAgQCBQQuAdiKkWAAAECBAgQIECAAAECBAgQIECAAAEC+QoI3PPtvZUTIECAAAECBAgQIECAAAECBAgQIECAQKCAwD0QUykCBAgQIECAAAECBAgQIECAAAECBAgQyFdA4J5v762cAAECBAgQIECAAAECBAgQIECAAAECBAIFBO6BmEoRIECAAAECBAgQIECAAAECBAgQIECAQL4CAvd8e2/lBAgQIECAAAECBAgQIECAAAECBAgQIBAoIHAPxFSKAAECBAgQIECAAAECBAgQIECAAAECBPIVELjn23srJ0CAAAECBAgQIECAAAECBAgQIECAAIFAAYF7IKZSBAgQIECAAAECBAgQIECAAAECBAgQIJCvgMA9395bOQECBAgQIECAAAECBAgQIECAAAECBAgECgjcAzGVIkCAAAECBAgQIECAAAECBAgQIECAAIF8BQTu+fbeygkQIECAAAECBAgQIECAAAECBAgQIEAgUEDgHoipFAECBAgQIECAAAECBAgQIECAAAECBAjkKyBwz7f3Vk6AAAECBAgQIECAAAECBAgQIECAAAECgQIC90BMpQgQIECAAAECBAgQIECAAAECBAgQIEAgXwGBe769t3ICBAgQIECAAAECBAgQIECAAAECBAgQCBQQuAdiKkWAAAECBAgQIECAAAECBAgQIECAAAEC+QoI3PPtvZUTIECAAAECBAgQIECAAAECBAgQIECAQHZUx7QAAAziSURBVKCAwD0QUykCBAgQIECAAAECBAgQIECAAAECBAgQyFdA4J5v762cAAECBAgQIECAAAECBAgQIECAAAECBAIFBO6BmEoRIECAAAECBAgQIECAAAECBAgQIECAQL4CAvd8e2/lBAgQIECAAAECBAgQIECAAAECBAgQIBAoIHAPxFSKAAECBAgQIECAAAECBAgQIECAAAECBPIVELjn23srJ0CAAAECBAgQIECAAAECBAgQIECAAIFAAYF7IKZSBAgQIECAAAECBAgQIECAAAECBAgQIJCvgMA9395bOQECBAgQIECAAAECBAgQIECAAAECBAgECgjcAzGVIkCAAAECBAgQIECAAAECBAgQIECAAIF8BQTu+fbeygkQIECAAAECBAgQIECAAAECBAgQIEAgUEDgHoipFAECBAgQIECAAAECBAgQIECAAAECBAjkKyBwz7f3Vk6AAAECBAgQIECAAAECBAgQIECAAAECgQIC90BMpQgQIECAAAECBAgQIECAAAECBAgQIEAgXwGBe769t3ICBAgQIECAAAECBAgQIECAAAECBAgQCBQQuAdiKkWAAAECBAgQIECAAAECBAgQIECAAAEC+QoI3PPtvZUTIECAAAECBAgQIECAAAECBAgQIECAQKCAwD0QUykCBAgQIECAAAECBAgQIECAAAECBAgQyFdA4J5v762cAAECBAgQIECAAAECBAgQIECAAAECBAIFBO6BmEoRIECAAAECBAgQIECAAAECBAgQIECAQL4CAvd8e2/lBAgQIECAAAECBAgQIECAAAECBAgQIBAoIHAPxFSKAAECBAgQIECAAAECBAgQIECAAAECBPIVELjn23srJ0CAAAECBAgQIECAAAECBAgQIECAAIFAAYF7IKZSBAgQIECAAAECBAgQIECAAAECBAgQIJCvgMA9395bOQECBAgQIECAAAECBAgQIECAAAECBAgECgjcAzGVIkCAAAECBAgQIECAAAECBAgQIECAAIF8BQTu+fbeygkQIECAAAECBAgQIECAAAECBAgQIEAgUEDgHoipFAECBAgQIECAAAECBAgQIECAAAECBAjkKyBwz7f3Vk6AAAECBAgQIECAAAECBAgQIECAAAECgQIC90BMpQgQIECAAAECBAgQIECAAAECBAgQIEAgXwGBe769t3ICBAgQIECAAAECBAgQIECAAAECBAgQCBQQuAdiKkWAAAECBAgQIECAAAECBAgQIECAAAEC+QoI3PPtvZUTIECAAAECBAgQIECAAAECBAgQIECAQKCAwD0QUykCBAgQIECAAAECBAgQIECAAAECBAgQyFdA4J5v762cAAECBAgQIECAAAECBAgQIECAAAECBAIFBO6BmEoRIECAAAECBAgQIECAAAECBAgQIECAQL4CAvd8e2/lBAgQIECAAAECBAgQIECAAAECBAgQIBAoIHAPxFSKAAECBAgQIECAAAECBAgQIECAAAECBPIVELjn23srJ0CAAAECBAgQIECAAAECBAgQIECAAIFAAYF7IKZSBAgQIECAAAECBAgQIECAAAECBAgQIJCvgMA9395bOQECBAgQIECAAAECBAgQIECAAAECBAgECgjcAzGVIkCAAAECBAgQIECAAAECBAgQIECAAIF8BQTu+fbeygkQIECAAAECBAgQIECAAAECBAgQIEAgUEDgHoipFAECBAgQIECAAAECBAgQIECAAAECBAjkKyBwz7f3Vk6AAAECBAgQIECAAAECBAgQIECAAAECgQIC90BMpQgQIECAAAECBAgQIECAAAECBAgQIEAgXwGBe769t3ICBAgQIECAAAECBAgQIECAAAECBAgQCBQQuAdiKkWAAAECBAgQIECAAAECBAgQIECAAAEC+QoI3PPtvZUTIECAAAECBAgQIECAAAECBAgQIECAQKCAwD0QUykCBAgQIECAAAECBAgQIECAAAECBAgQyFdA4J5v762cAAECBAgQIECAAAECBAgQIECAAAECBAIFBO6BmEoRIECAAAECBAgQIECAAAECBAgQIECAQL4CAvd8e2/lBAgQIECAAAECBAgQIECAAAECBAgQIBAoIHAPxFSKAAECBAgQIECAAAECBAgQIECAAAECBPIVELjn23srJ0CAAAECBAgQIECAAAECBAgQIECAAIFAAYF7IKZSBAgQIECAAAECBAgQIECAAAECBAgQIJCvgMA9395bOQECBAgQIECAAAECBAgQIECAAAECBAgECgjcAzGVIkCAAAECBAgQIECAAAECBAgQIECAAIF8BQTu+fbeygkQIECAAAECBAgQIECAAAECBAgQIEAgUEDgHoipFAECBAgQIECAAAECBAgQIECAAAECBAjkKyBwz7f3Vk6AAAECBAgQIECAAAECBAgQIECAAAECgQIC90BMpQgQIECAAAECBAgQIECAAAECBAgQIEAgXwGBe769t3ICBAgQIECAAAECBAgQIECAAAECBAgQCBQQuAdiKkWAAAECBAgQIECAAAECBAgQIECAAAEC+QoI3PPtvZUTIECAAAECBAgQIECAAAECBAgQIECAQKCAwD0QUykCBAgQIECAAAECBAgQIECAAAECBAgQyFdA4J5v762cAAECBAgQIECAAAECBAgQIECAAAECBAIFBO6BmEoRIECAAAECBAgQIECAAAECBAgQIECAQL4CAvd8e2/lBAgQIECAAAECBAgQIECAAAECBAgQIBAoIHAPxFSKAAECBAgQIECAAAECBAgQIECAAAECBPIVELjn23srJ0CAAAECBAgQIECAAAECBAgQIECAAIFAAYF7IKZSBAgQIECAAAECBAgQIECAAAECBAgQIJCvgMA9395bOQECBAgQIECAAAECBAgQIECAAAECBAgECgjcAzGVIkCAAAECBAgQIECAAAECBAgQIECAAIF8BQTu+fbeygkQIECAAAECBAgQIECAAAECBAgQIEAgUEDgHoipFAECBAgQIECAAAECBAgQIECAAAECBAjkKyBwz7f3Vk6AAAECBAgQIECAAAECBAgQIECAAAECgQIC90BMpQgQIECAAAECBAgQIECAAAECBAgQIEAgXwGBe769t3ICBAgQIECAAAECBAgQIECAAAECBAgQCBQQuAdiKkWAAAECBAgQIECAAAECBAgQIECAAAEC+QoI3PPtvZUTIECAAAECBAgQIECAAAECBAgQIECAQKCAwD0QUykCBAgQIECAAAECBAgQIECAAAECBAgQyFdA4J5v762cAAECBAgQIECAAAECBAgQIECAAAECBAIFBO6BmEoRIECAAAECBAgQIECAAAECBAgQIECAQL4CAvd8e2/lBAgQIECAAAECBAgQIECAAAECBAgQIBAoIHAPxFSKAAECBAgQIECAAAECBAgQIECAAAECBPIVELjn23srJ0CAAAECBAgQIECAAAECBAgQIECAAIFAAYF7IKZSBAgQIECAAAECBAgQIECAAAECBAgQIJCvgMA9395bOQECBAgQIECAAAECBAgQIECAAAECBAgECgjcAzGVIkCAAAECBAgQIECAAAECBAgQIECAAIF8BQTu+fbeygkQIECAAAECBAgQIECAAAECBAgQIEAgUEDgHoipFAECBAgQIECAAAECBAgQIECAAAECBAjkKyBwz7f3Vk6AAAECBAgQIECAAAECBAgQIECAAAECgQIC90BMpQgQIECAAAECBAgQIECAAAECBAgQIEAgXwGBe769t3ICBAgQIECAAAECBAgQIECAAAECBAgQCBQQuAdiKkWAAAECBAgQIECAAAECBAgQIECAAAEC+QoI3PPtvZUTIECAAAECBAgQIECAAAECBAgQIECAQKCAwD0QUykCBAgQIECAAAECBAgQIECAAAECBAgQyFdA4J5v762cAAECBAgQIECAAAECBAgQIECAAAECBAIFBO6BmEoRIECAAAECBAgQIECAAAECBAgQIECAQL4CAvd8e2/lBAgQIECAAAECBAgQIECAAAECBAgQIBAoIHAPxFSKAAECBAgQIECAAAECBAgQIECAAAECBPIVELjn23srJ0CAAAECBAgQIECAAAECBAgQIECAAIFAAYF7IKZSBAgQIECAAAECBAgQIECAAAECBAgQIJCvgMA9395bOQECBAgQIECAAAECBAgQIECAAAECBAgECgjcAzGVIkCAAAECBAgQIECAAAECBAgQIECAAIF8BQTu+fbeygkQIECAAAECBAgQIECAAAECBAgQIEAgUEDgHoipFAECBAgQIECAAAECBAgQIECAAAECBAjkKyBwz7f3Vk6AAAECBAgQIECAAAECBAgQIECAAAECgQIC90BMpQgQIECAAAECBAgQIECAAAECBAgQIEAgX4H/B4GyJkJ7whYXAAAAAElFTkSuQmCC'
    image = read_and_crop_image(image)
    image.save(PATH_TO_TEMP + 'image.png', 'PNG')
    prediction = predict_own_handwriting()
    response = jsonify({'text': prediction})
    response.headers.add('Access-Control-Allow-Origin', 'http://localhost:4200')
    return response


if __name__ == '__main__':
    app.run(debug=True, host='0.0.0.0')
